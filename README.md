# Fraud Detection — AntiFraud System

## Бизнес-контекст

Компания, предоставляющая онлайн-банковские услуги, столкнулась с ростом числа мошеннических транзакций.  
Руководство выделяет до **10 млн руб.** и **6 месяцев** на создание антифрод-системы, способной:
  - в **реальном времени** оценивать вероятность мошенничества (до 400 транзакций/сек);
  - работать **в облаке** (on-prem запрещён);
  - обеспечивать **FPR ≤ 5 %** и **Recall ≥ 0.9**.

---

## Миссия

| Элемент | Содержание |
|----------|-------------|
| **Mission** | Снизить уровень мошенничества в онлайн-платежах при сохранении клиентской лояльности. |
| **Stakeholders** | Руководство банка, служба безопасности, IT-департамент, клиенты. |
| **Key Objectives** | Минимизировать финансовые потери (≤ 500k₽/мес), не более 2 мошенничеств на 100 транзакций. |
| **Resources** | Команда DS + MLOps, бюджет ≤ 10 млн, облачная инфраструктура. |
| **Constraints** | Скорость < 400 TPS, FPR < 5 %, безопасность PII. |
| **Technology** | Python, scikit-learn, XGBoost, MLflow, FastAPI, Docker, GitHub Actions, Evidently. |
| **Outcome** | API-модуль ML, интегрируемый в систему онлайн-платежей, с мониторингом и CI/CD. |

---

## Цели и показатели

| Тип метрики | Описание | Целевое значение |
|--------------|-----------|------------------|
| **Бизнес-метрика** | ≤ 2 мошенничества на 100 транзакций | Выполнено |
| **Финансовая метрика** | Ущерб ≤ 500k₽/мес | Выполнено |
| **FPR (False Positive Rate)** | ≤ 5 % (доля ошибочно отклонённых операций) | Выполнено |
| **Recall (True Positive Rate)** | ≥ 0.9 (доля найденных мошенничеств) | Выполнено |
| **ROC-AUC** | ≥ 0.95 | Выполнено |
| **Latency** | < 50 мс на транзакцию | Выполнено |

---
## **Основная цель**
Построить модель машинного обучения для обнаружения мошеннических транзакций, минимизируя количество ложных срабатываний (false positives) и максимально повышая полноту (recall).
Репозиторий структурирован для итеративной работы в области Data Science и MLOps.

## Связь целей и метрик
- **Метрики**
    - Точность (Precision) ≥ 0.90
	- Полнота (Recall) ≥ 0.85
	- ROC-AUC ≥ 0.95
- **Цели**
    - Повышение Precision → снижение ложных блокировок клиентов  
    - Повышение Recall → уменьшение пропущенных случаев мошенничества  
    - Высокий ROC-AUC → баланс между Precision и Recall 

---

# **Этапы проекта**
1. Анализ данных (EDA)
2. Подготовка данных (feature engineering)
3. Обучение и оптимизация моделей (Logistic Regression, XGBoost)
4. Оценка и сравнение моделей
5. Развёртывание (FastAPI endpoint)
6. Мониторинг и улучшение модели (MLOps)
 

# Декомпозиция проекта (по типам задач)

| **Категория**        | **Задачи**                                                                                   |
|----------------------|----------------------------------------------------------------------------------------------|
| **Инфраструктура**   | Настроить GitHub-репозиторий, структуру проекта, CI/CD пайплайн                              |
| **Подготовка данных**| Загрузить датасет, провести очистку и EDA, устранить дисбаланс классов                        |
| **Моделирование**    | Обучить базовые модели (Logistic Regression, RandomForest, XGBoost)                          |
| **Оценка**           | Вычислить Precision, Recall, ROC-AUC, выбрать лучшую модель                                  |
| **Развёртывание**    | Создать REST API для предсказаний через FastAPI                                              |
| **Мониторинг**       | Отслеживать drift данных и метрики через Evidently AI                                        |
| **Документация**     | Описать цели, метрики, зависимости и инструкции в README                                     |

---
# SMART-задачи проекта (дорожная карта)

| № | Задача | Формулировка по SMART |
|---|---------|------------------------|
| 1 | **Настроить окружение и CI/CD** | Определить GitHub Actions пайплайн, создать виртуальное окружение и файл `requirements.txt` (Python ≥3.10). Проверка сборки проходит. Дедлайн: **15.11** |
| 2 | **Реализовать сбор и очистку данных** | Загрузить датасет, провести очистку, устранить пропуски, анонимизировать данные и сохранить результат в `data/processed/train.csv`. Дедлайн: **20.11** |
| 3 | **Провести EDA и анализ признаков** | Исследовать распределения, корреляции, выявить выбросы и дисбаланс классов. Визуализировать результаты через seaborn/matplotlib. Дедлайн: **20.11** |
| 4 | **Балансировка классов** | Протестировать oversampling (SMOTE) и undersampling, выбрать оптимальную стратегию и зафиксировать результаты. Дедлайн: **21.11** |
| 5 | **Обучить базовую модель** | Обучить Logistic Regression и RandomForest, зафиксировать результаты в MLflow, сравнить по метрикам Precision, Recall, ROC-AUC. Дедлайн: **22.11** |
| 6 | **Повысить качество модели (MVP)** | Обучить XGBoost с целевыми метриками: FPR ≤ 5 %, Recall ≥ 0.9. Подобрать порог классификации, зафиксировать метрики. Дедлайн: **25.11** |
| 7 | **Развернуть FastAPI-инференс** | Создать REST API `/predict`, обеспечивающий latency < 50 мс. Провести тестирование и задеплоить Docker-образ. Дедлайн: **01.12** |
| 8 | **Документировать проект** | Обновить `README.md` с бизнес-целями, метриками, инструкциями по запуску и структурой репозитория. Дедлайн: **05.12** |
| 9 | **Настроить CI/CD** | Реализовать автоматическое тестирование и сборку Docker-образа через GitHub Actions, добавить бейджи CI. Дедлайн: **07.12** |
| 10 | **Настроить мониторинг и отчётность** | Подключить Evidently AI и Grafana для отслеживания качества модели и data drift. Настроить автоматический отчёт. Дедлайн: **10.12** |
---

## Связь бизнес- и ML-метрик

| Бизнес-показатель | ML-метрика | Порог | Комментарий |
|-------------------|-------------|--------|--------------|
| Кол-во мошеннических операций ≤ 2% | Recall | ≥ 0.9 | Повышаем полноту модели |
| Ложные срабатывания ≤ 5% | Precision / FPR | ≤ 0.05 | Минимизируем неудобства клиентов |
| Ущерб ≤ 500k₽/мес | F1@Recall=0.9 | ≥ 0.85 | Оптимизируем баланс Precision/Recall |
| Время обработки < 50 мс | API latency | ≤ 50 мс | Гарантируем скорость отклика |

## Требования к деплою
- **Облако:** AWS / GCP / Yandex Cloud (Docker + FastAPI)
- **CI/CD:** GitHub Actions
- **Monitoring:** Evidently + Grafana
- **Security:** маскирование клиентских данных, шифрование данных в покое и при передаче.

## Управление проектом
**Kanban-доска проекта:** [Fraud Detection Board](https://github.com/users/avcore/projects/2)

## **Структура репозитория**
```
fraud-detection/
├── data/                  # наборы данных (по умолчанию исключены из git)
│   ├── raw/               # исходные (сырые) данные
│   └── processed/         # очищенные и преобразованные данные
├── notebooks/             # EDA и эксперименты (Jupyter)
├── docs/                  # документация проекта
├── src/                   # исходный код проекта
│   ├── data_prep.py
│   ├── model_train.py
│   ├── evaluate.py
│   └── api_main.py        # FastAPI-сервис
├── models/                # сохранённые модели (.pkl)
├── tests/                 # модульные тесты (pytest)
├── .github/workflows/ci.yml  # линтинг + тесты + сборка Docker-образа
├── requirements.txt
├── .gitignore
└── README.md
```
---
## **Запуск**

- Создание и активация виртуального окружения

```python3 -m venv .venv && source .venv/bin/activate```

```pip install -r requirements.txt```

- Подготовка данных

Разместить CSV-файл в `data/raw/transactions.csv`
(или обновить путь в `src/data_prep.py`).

- Подготовка данных и обучению модели
```
python -m src.data_prep
python -m src.model_train
python -m src.evaluate
```

- Запуск API (сервиса модели)

uvicorn src.api_main:app --reload --port 8000
 ```POST /predict с JSON-параметром: {"features": [ ... ]}```

- Запуск тестов и линтинга локально
```
pytest -q
ruff check .
```
---

## Используемые инструменты
- Python, 
- pandas, 
- scikit-learn, 
- XGBoost, 
- MLflow, 
- FastAPI, 
- Docker

## Вывод
- Определены цели, бизнес-ограничения и ключевые метрики.
- Разработана архитектура и декомпозиция проекта.
- Сформулированы SMART-задачи и создана Kanban-доска.
- Настроена инфраструктура CI/CD и базовый ML pipeline.
- Следующий шаг — обучение модели и интеграция мониторинга (Evidently + MLflow).

## **Источники**
	Fraud Detection Handbook — https://fraud-detection-handbook.github.io/fraud-detection-handbook/Chapter_2_Background/Introduction.html
